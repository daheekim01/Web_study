`.htaccess` 파일은 **Apache 웹 서버에서 디렉터리별 설정을 정의할 수 있는 구성 파일**로, **잘못 구성되거나 노출되면 심각한 보안 취약점**으로 이어질 수 있습니다.

---

## 🛠 `.htaccess`란?

* Apache 웹 서버에서 **디렉터리별로 설정을 오버라이드**할 수 있게 해주는 파일
* 예: URL 재작성, 접근 제어, MIME 타입 설정 등
* 웹 루트 또는 하위 디렉터리에 위치함

---

## 🔓 `.htaccess` 관련 주요 취약점

### 1. `.htaccess` 파일 자체가 외부에 **노출됨**

#### ❌ 예시:

* 사용자가 `https://example.com/.htaccess` 에 접근할 수 있고, 내용이 그대로 보임

#### ⚠️ 위험성:

* 내부 설정 노출 (예: rewrite rule, 비밀번호 파일 경로 등)
* 경로 구조, 보안 설정 등이 공격자에게 분석됨

#### ✅ 대응:

```apache
<Files ".ht*">
  Require all denied
</Files>
```

---

### 2. 접근 제한 설정 오류 (디렉터리 보호 실패)

#### ❌ 예시:

```apache
<Directory "/var/www/html/private">
  Allow from all
</Directory>
```

→ 의도와 달리 **누구나 접근 가능**

#### ✅ 대응:

```apache
<Directory "/var/www/html/private">
  Require all denied
</Directory>
```

---

### 3. `mod_rewrite`를 통한 우회 가능성

* Rewrite 규칙이 허술할 경우, 공격자가 내부 파일이나 관리자 페이지로 우회 가능

#### ❌ 예시:

```apache
RewriteRule ^.*$ index.php [L]
```

→ 모든 요청을 `index.php`로 넘기면 필터링 우회 가능성 존재

---

### 4. `.htaccess`에 PHP 실행 허용 설정 → 웹셸 실행

#### ❌ 예시 (공격자가 업로드한 디렉터리에 존재할 경우):

```apache
AddHandler application/x-httpd-php .txt
```

→ `.txt` 파일도 PHP로 실행됨
→ `shell.txt` 업로드 → 웹셸 실행 가능

#### ✅ 대응:

* 파일 업로드 디렉터리에는 `.htaccess`로 PHP 실행 금지:

```apache
php_flag engine off
```

또는:

```apache
RemoveHandler .php .phtml .php3 .php4
```

---

### 5. 인증 정보 누출

* `.htaccess`에 설정된 `.htpasswd` 경로 또는 사용자 정보 노출 시, **인증 우회 시도 가능**

---

## 🧩 공격자가 활용할 수 있는 시나리오

| 시나리오       | 설명                                         |
| ---------- | ------------------------------------------ |
| 디렉터리 인덱싱   | `.htaccess`에서 인덱스 제한이 없으면, 디렉터리 내부 파일이 노출됨 |
| 우회 및 권한 상승 | Rewrite 설정이 허술하면 인증 우회, 내부 페이지 접근 가능       |
| 악성 파일 실행   | 업로드된 `.htaccess`로 MIME 타입 변경 → 웹셸 실행       |
| 보안 설정 제거   | 공격자가 `.htaccess`를 조작하여 보안 설정을 무력화함         |

---

## ✅ 요약

| 취약점 유형  | 설명                                    |
| ------- | ------------------------------------- |
| 파일 노출   | `.htaccess` 내용이 외부에 노출되면 정보 유출 위험     |
| 설정 오류   | 접근 제한, Rewrite 규칙이 잘못되면 보안 우회 가능      |
| MIME 조작 | 업로드된 `.htaccess`로 PHP 실행 가능하게 만들 수 있음 |
| 보안 무력화  | 공격자가 직접 `.htaccess`를 업로드하거나 수정하면 큰 위험 |

