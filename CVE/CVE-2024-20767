이 룰은 **Adobe ColdFusion 서버의 디렉토리 탈출(Local File Inclusion, LFI)** 취약점,
특히 **CVE-2024-20767**을 악용하려는 시도를 탐지하기 위한 **WAF 보안 룰**입니다.

---

## 🛡️ 룰 ID: `3000936`

| 항목           | 설명                                                             |
| ------------ | -------------------------------------------------------------- |
| **이름**       | `Adobe ColdFusion Arbitrary File System Read Detected`         |
| **CVE**      | `CVE-2024-20767`                                               |
| **버전**       | v.1                                                            |
| **selector** | `ARGS:file_name` → 요청 파라미터 중 `file_name`                       |
| **match**    | `../../../../../../~/.aws/credentials` → 디렉토리 탈출 경로 및 민감 파일 타겟 |

---

## 📌 공격 시나리오

이 룰은 다음과 같은 요청을 탐지합니다:

```
GET /some-endpoint?file_name=../../../../../../~/.aws/credentials
```

여기서 공격자는:

* `file_name`이라는 파라미터를 통해
* 상위 디렉토리로 계속 올라간 뒤 (`../../`)
* 시스템 사용자의 홈 디렉토리 아래 `.aws/credentials` 파일을 시도합니다.

### 📂 타겟 파일: `~/.aws/credentials`

이 파일은:

* AWS CLI 또는 SDK가 사용하는 인증 파일입니다.
* 보통 다음과 같은 형식:

```
[default]
aws_access_key_id=AKIAIOSFODNN7EXAMPLE
aws_secret_access_key=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
```

즉, 이걸 읽으면 공격자는 **AWS 자격 증명 탈취 → 클라우드 리소스 접근 가능**입니다.

---

## 🧨 CVE-2024-20767 개요

| 항목         | 내용                                    |
| ---------- | ------------------------------------- |
| **제품**     | Adobe ColdFusion (2023, 2021 등 일부 버전) |
| **취약점 종류** | Arbitrary File Read (임의 파일 읽기)        |
| **공격 방식**  | 특정 매개변수를 조작하여 서버 내 파일 경로 접근 가능        |
| **위험도**    | 🔥 매우 높음 — 인증 없이 민감 파일 노출 가능          |

---

## 🎯 탐지 룰 목적

* `ARGS:file_name` 파라미터에서
* `../../../../...` 형태의 **디렉토리 탈출 시도** +
  `~/.aws/credentials` 같은 **민감 파일 접근 시도** 감지

---

## ✅ 대응 방법

| 항목                  | 조치                                                                    |
| ------------------- | --------------------------------------------------------------------- |
| 🔐 ColdFusion 보안 패치 | Adobe가 제공한 보안 패치 적용 필수 (CVE-2024-20767 대응)                            |
| 🧱 WAF 룰 적용         | 해당 시그니처 포함한 LFI 필터 적용 (`../../`, `.aws/credentials`, `/etc/passwd` 등) |
| 🚫 디렉토리 접근 제한       | 웹 루트 밖 파일 접근 제한, 파일 경로 사용자 입력 사용 금지                                   |
| 📂 민감 파일 보호         | AWS 자격 증명은 웹서버가 접근 가능한 위치에 두지 말 것                                     |
| 📝 로깅 및 IP 차단       | 탐지된 요청 로그 추적 후 공격자 IP 차단 가능 고려                                        |

---

## 📌 요약

| 항목     | 내용                                                       |
| ------ | -------------------------------------------------------- |
| 룰 ID   | 3000936                                                  |
| 대상 취약점 | CVE-2024-20767 (Adobe ColdFusion LFI)                    |
| 공격 의도  | `file_name=../../.../.aws/credentials` → AWS 자격 증명 파일 노출 |
| 대응     | 보안 패치, 필터링, 웹 루트 경계 관리, 로깅 & 경고 설정 등                     |

---

필요하시면 **실제 취약 ColdFusion 경로 구조**나
WAF에서 사용할 \*\*커스텀 차단 룰 예시 (ModSecurity 등)\*\*도 제공해드릴 수 있습니다.
