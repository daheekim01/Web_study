`.htaccess` 파일은 **Apache 웹 서버에서 디렉터리별 설정을 정의할 수 있는 구성 파일**로, **잘못 구성되거나 노출되면 심각한 보안 취약점**으로 이어질 수 있다.

---

## 🛠 `.htaccess`란?

* Apache 웹 서버에서 **디렉터리별로 설정을 오버라이드**할 수 있게 해주는 파일 (AllowOverride All이 설정되어 있다면 .htaccess로 해당 디렉토리의 환경설정을 변경할 수 있다.)
* 예: URL 재작성, 접근 제어, MIME 타입 설정 등
* 웹 루트 또는 하위 디렉터리에 위치
* 여러 설정 시지어가 있는 파일을 특정 문서 디렉토리에 두면, 그 디렉토리와 모든 하위디렉토리에 지시어를 적용한다

---

## 🔓 `.htaccess` 관련 주요 취약점

### 1. `.htaccess` 파일 자체가 외부에 **노출됨**

#### ❌ 예시:

* 사용자가 `https://example.com/.htaccess` 에 접근할 수 있고, 내용이 그대로 보임

#### ⚠️ 위험성:

* 내부 설정 노출 (예: rewrite rule, 비밀번호 파일 경로 등)
* 경로 구조, 보안 설정 등이 공격자에게 분석됨

#### ✅ 대응:

```apache
<Files ".ht*">
  Require all denied
</Files>
```

---

### 2. 접근 제한 설정 오류 (디렉터리 보호 실패)

#### ❌ 예시:

```apache
<Directory "/var/www/html/private">
  Allow from all
</Directory>
```

→ 의도와 달리 **누구나 접근 가능**

#### ✅ 대응:

```apache
<Directory "/var/www/html/private">
  Require all denied
</Directory>
```

---

### 3. `mod_rewrite`를 통한 우회 가능성

* Rewrite 규칙이 허술할 경우, 공격자가 내부 파일이나 관리자 페이지로 우회 가능

#### ❌ 예시:

```apache
RewriteRule ^.*$ index.php [L]
```

→ 모든 요청을 `index.php`로 넘기면 필터링 우회 가능성 존재

---

### 4. `.htaccess`에 PHP 실행 허용 설정 → 웹셸 실행

#### ❌ 예시 (공격자가 업로드한 디렉터리에 존재할 경우):

```apache
AddHandler application/x-httpd-php .txt
```

→ `.txt` 파일도 PHP로 실행됨
→ `shell.txt` 업로드 → 웹셸 실행 가능

#### ✅ 대응:

* 파일 업로드 디렉터리에는 `.htaccess`로 PHP 실행 금지:

```apache
php_flag engine off
```

또는:

```apache
RemoveHandler .php .phtml .php3 .php4
```

---

### 5. 인증 정보 누출

* `.htaccess`에 설정된 `.htpasswd` 경로 또는 사용자 정보 노출 시, **인증 우회 시도 가능**

---

## 🧩 공격자가 활용할 수 있는 시나리오

| 시나리오       | 설명                                         |
| ---------- | ------------------------------------------ |
| 디렉터리 인덱싱   | `.htaccess`에서 인덱스 제한이 없으면, 디렉터리 내부 파일이 노출됨 |
| 우회 및 권한 상승 | Rewrite 설정이 허술하면 인증 우회, 내부 페이지 접근 가능       |
| 악성 파일 실행   | 업로드된 `.htaccess`로 MIME 타입 변경 → 웹셸 실행       |
| 보안 설정 제거   | 공격자가 `.htaccess`를 조작하여 보안 설정을 무력화함         |

---

## ✅ 요약

| 취약점 유형  | 설명                                    |
| ------- | ------------------------------------- |
| 파일 노출   | `.htaccess` 내용이 외부에 노출되면 정보 유출 위험     |
| 설정 오류   | 접근 제한, Rewrite 규칙이 잘못되면 보안 우회 가능      |
| MIME 조작 | 업로드된 `.htaccess`로 PHP 실행 가능하게 만들 수 있음 |
| 보안 무력화  | 공격자가 직접 `.htaccess`를 업로드하거나 수정하면 큰 위험 |

---

`.htpasswd`는 Apache 웹 서버에서 **디렉터리 접근을 제한하기 위해 사용자 인증 정보를 저장하는 파일**
보통 `.htaccess`와 함께 사용되어 특정 디렉터리에 접근하려는 사용자에게 **아이디와 비밀번호를 요구**


## 🔐 `.htpasswd`란?

* **사용자 계정과 암호 해시**를 저장하는 **텍스트 파일**
* 일반적으로 `.htaccess` 파일에서 위치를 지정해 사용됨
* 예시:

  ```text
  user1:$apr1$w3dT9...$nJzZQX0RExRmK3p7T1yVe0
  ```

---

## 🛠️ 기본 사용 구조

### 1. `.htaccess` 설정 예:

```apache
AuthType Basic
AuthName "Restricted Area"
AuthUserFile /var/www/html/.htpasswd
Require valid-user
```

### 2. `.htpasswd` 파일 내용:

```text
admin:$apr1$TjH45...$KxDkl9VJpG9vKucjfd8l91
user:$apr1$abc123...$Xx81vVsdfsoffk2B1
```

> ※ 암호는 일반적으로 **MD5 (Apache의 `apr1`)**, **SHA1**, 또는 **bcrypt**로 해시됨

---

## ❌ `.htpasswd` 취약점 및 위험 요소

### 1. `.htpasswd` 파일이 외부에 **노출**될 경우

* URL로 직접 접근이 가능하면 심각한 정보 유출
* 예: `https://example.com/.htpasswd`

✅ **대응 방법**:

```apache
<Files ".ht*">
  Require all denied
</Files>
```

또는 웹 루트 밖 (`/etc/`, `/home/`)에 파일을 보관

---

### 2. 평문 비밀번호 또는 약한 해시 사용

* 공격자가 파일을 얻었을 경우, 약한 해시는 **레인보우 테이블이나 브루트포스로 빠르게 크랙** 가능

✅ **대응 방법**:

* `htpasswd` 명령어로 bcrypt 해시 생성

  ```bash
  htpasswd -B -c .htpasswd user1
  ```

---

### 3. 경로 설정 실수

* `.htaccess`에서 `AuthUserFile` 경로가 잘못되면 인증이 **우회되거나 무시**될 수 있음

---

### 4. HTTP Basic Auth 자체의 한계

* 평문 HTTP에서 사용 시, **Base64 인코딩된 자격 증명이 노출**됨
* 공격자가 네트워크 스니핑 시 쉽게 탈취 가능

✅ **대응 방법**:

* 반드시 **HTTPS 환경에서 사용**

---

| 항목          | 점검 내용       |
| ----------- | ----------- |
| 🔐 외부 접근 차단 | `.htpasswd` |

