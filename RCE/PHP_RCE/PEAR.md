## 1) PEAR (PHP Extension and Application Repository) 시스템

### 🍐 PEAR이란?

PEAR는 PHP에서 사용할 수 있는 확장 라이브러리와 응용 프로그램을 관리하는 **패키지 관리 시스템**입니다.
여기서 PEAR의 주요 특징은 다음과 같습니다:

* **php-pear**라는 명령어로 PHP 확장 기능을 설치하고 관리할 수 있습니다.
* PEAR 시스템에 설치된 라이브러리들은 `/usr/local/lib/php/` 등 시스템의 특정 경로에 위치합니다.

### PEAR 관련 취약점

PEAR의 특정 명령어는 시스템 내에서 **PHP 코드 실행**을 허용하는 방식으로 동작할 수 있습니다.
따라서 공격자가 PEAR의 명령어를 악용하려는 경우, **명령어 삽입(command injection)** 기법을 통해 **원격 코드 실행**(RCE) 등의 공격을 할 수 있습니다.

---

## 2) 공격 예시: 

```
../usr/local/lib/php/pearcmd&/safedog()+bxf1GaJYWB.log
```

### 1) **`../`** (디렉토리 탐색)

* **`../`**는 디렉토리 탐색 패턴으로, **상위 디렉토리로 이동**하는 상대 경로를 나타냅니다.

  * 예를 들어, `/usr/local/lib/php/pearcmd`에서 `../`를 사용하면 `/usr/local/lib/`로 이동하게 됩니다.
* 따라서 이 부분은 공격자가 **PEAR 명령어**가 위치한 시스템의 **상위 디렉토리**로 접근하려는 시도일 수 있습니다.

### 2) **`pearcmd`** (PEAR 명령어)

* **`pearcmd`**는 PEAR와 관련된 명령어인 것으로 보입니다. 이 명령어는 PEAR의 명령어 실행을 위해 사용됩니다.
* 보통 PEAR의 설치된 경로나 명령어가 실행되는 위치에서, 공격자는 이 명령어를 **악용**하려 할 수 있습니다.
  예를 들어, PEAR의 명령어를 통해 PHP의 **명령어 실행** 기능을 악용할 수 있습니다.

### 3) **`&`** (명령어 연결)

* `&`는 쉘에서 **백그라운드 명령어 실행**이나 **명령어 연결**을 위해 사용됩니다.

  * 예를 들어, `command1 & command2`와 같이 사용할 수 있으며, `command1`이 끝난 후에 `command2`를 실행하게 됩니다.
  * 공격자는 이를 이용해 PEAR 명령어 실행 후, **다른 악성 명령어**를 동시에 실행할 수 있습니다.

### 4) **`/safedog()+`** (악성 함수 또는 스크립트 삽입)

* `/safedog()`는 특정 악성 **PHP 함수**나 **스크립트**의 이름일 가능성이 높습니다. **`safedog()`**은 실시간 웹 방어 솔루션의 이름으로도 쓰이지만, 이 부분이 실제로 시스템에 설치된 악성 함수일 수 있습니다.
* 해당 함수가 **백도어**나 **악성 코드**를 실행하는 역할을 할 수 있으며, PEAR 명령어 이후 호출되는 경우 **명령어 실행을 통한 RCE**가 발생할 수 있습니다.

### 5) **`bxf1GaJYWB.log`** (로그 파일)

* `bxf1GaJYWB.log`는 **로그 파일**의 이름처럼 보입니다.
  이는 공격자가 **출력 결과**나 **실행 로그**를 기록하기 위한 로그 파일일 수 있습니다.
  또한 공격자는 이를 통해 **공격 결과를 기록**하거나 **백도어 동작 확인** 등을 할 수 있습니다.
* 로그 파일이 시스템에 생성되면, 그 안에 **이상 동작이나 공격의 흔적**을 남길 수 있기 때문에, 공격자가 **후속 공격을 진행하기 위한 발판**을 마련하는 경우도 있습니다.

---

## 3) 공격 기법 (LFI(Local File Inclusion) + PEAR 악용)
원격에서 웹쉘 또는 임의 코드 생성 혹은 서버에 파일 쓰기 명령 실행 시도 공격

### 예시

LFI를 이용해 pearcmd.php 실행을 유발하려는 패턴 

```
https://test.com/index.php?lang\=../../../../../../../../usr/local/lib/php/pearcmd&+config-create+/&/<?echo(md5(\"hi\"));?>+/tmp/index1.php
```

pearcmd는 원래 PHP 패키지 관리용 CLI 파일인데, LFI를 통해 웹에서 호출하면 임의 명령 실행이 가능해집니다.

```
+config-create+/&/<?echo(md5("hi"));?>+/tmp/index1.php
```


이는 pearcmd의 옵션 형식을 이용해

* ✔ 임의 PHP 파일 생성(config-create) 후
* ✔ 내용에 echo(md5("hi")); 를 삽입해 
* ✔ /tmp/index1.php에 생성


