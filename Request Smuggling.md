`HEAD` 메서드와 `Content-Length` 헤더를 조합한 공격은 **비정상적인 요청 조작** 또는 \*\*HTTP 요청 스머글링(Request Smuggling)\*\*과 같은 취약점과 연관될 수 있습니다.

---

## 🔥 요약 먼저

| 항목       | 설명                                                                  |
| -------- | ------------------------------------------------------------------- |
| 요청 메서드   | `HEAD` (응답 본문이 없어야 함)                                               |
| 헤더       | `Content-Length` (본문 길이를 정의함)                                       |
| 문제       | 본문이 없는데 `Content-Length`가 있으면, 서버가 **파싱 혼란**을 겪거나, **스머글링 가능성**이 생김 |
| 주요 공격 유형 | ✅ **Request Smuggling**, ✅ **WAF 우회**, ✅ **서버 파싱 오류 유발** 등          |

---

## ✅ `HEAD` 메서드란?

* **브라우저나 클라이언트가 응답 헤더만 확인하고 싶을 때 사용**
* `GET` 요청과 거의 동일하지만, **본문(body)은 포함하지 않음**

```http
HEAD /index.html HTTP/1.1
Host: example.com
```

응답:

```http
HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 1234
```

⛔ 본문은 없음!

---

## 🚨 그런데 여기에 `Content-Length` 헤더를 넣으면?

```http
HEAD / HTTP/1.1
Host: vulnerable.com
Content-Length: 10
```

* `HEAD` 요청인데 **본문을 보내는 건 비표준**
* 서버마다 해석이 다를 수 있음 → 파싱 불일치 발생 가능

이게 바로 \*\*Request Smuggling (요청 스머글링)\*\*의 전형적인 시나리오입니다.

---

## 💥 공격 예시: Request Smuggling via HEAD + Content-Length

### 프록시(또는 CDN)는 이렇게 해석:

* `Content-Length: 10` 있으니까 바디 포함 요청으로 처리
* 따라서 **다음 요청은 분리된 요청**으로 생각함

### 백엔드는 이렇게 해석:

* `HEAD` 요청이니까 **본문은 무시**
* → 뒤에 붙은 데이터까지 포함해서 **한 요청으로 처리**

이 **파싱 불일치** 때문에:

* \*\*숨겨진 두 번째 요청(GET /admin 등)\*\*이 백엔드로 조용히 전달됨
* 인증 우회, 요청 변조, 세션 탈취 등이 발생할 수 있음

---

## 📌 또 다른 문제: 방화벽 우회

많은 WAF(Web Application Firewall)는:

* `POST`, `PUT` 같은 메서드는 더 엄격히 검사함
* 하지만 `HEAD`는 "읽기 전용"이라고 생각해서 검사 우회되는 경우도 있음

공격자는 이를 이용해서:

* 악성 요청을 `HEAD`로 보낸 뒤
* `Content-Length`를 조작해 **요청 구조를 흐트러뜨리거나**,
* **WAF를 우회해 백엔드에 요청을 전달**

---

## 🔍 의심 로그 예시

```http
HEAD / HTTP/1.1
Host: example.com
Content-Length: 11

GET /admin HTTP/1.1
Host: example.com
```

### 서버 파싱 결과:

* 첫 번째 요청은 `HEAD /`
* 두 번째 요청인 `GET /admin`은 백엔드로 몰래 전달됨 💀

---

## 🛡️ 방어 방법

| 방어 방법                                          | 설명                                  |
| ---------------------------------------------- | ----------------------------------- |
| ✅ `HEAD` 요청에 `Content-Length` 있으면 거부           | 명확히 비표준 → WAF 또는 서버에서 차단            |
| ✅ `Transfer-Encoding` + `Content-Length` 조합 차단 | 이 조합은 스머글링의 주요 수단                   |
| ✅ 웹서버 및 프록시 파싱 일치                              | Nginx, Apache, CDN, 백엔드 모두 같은 규칙 사용 |
| ✅ WAF에서 `HEAD` + `Content-Length` 패턴 감시        | 비정상 조합으로 탐지 규칙 강화                   |

---

## ✅ 정리 요약

| 질문         | 내용                                     |
| ---------- | -------------------------------------- |
| 문제 상황      | `HEAD` 요청에 `Content-Length`를 넣는 것은 비정상 |
| 어떤 공격이 가능? | Request Smuggling, 인증 우회, WAF 우회       |
| 왜 발생하나?    | 서버나 프록시 간의 **파싱 방식 불일치**               |
| 방어 방법은?    | 비정상 조합 차단, 파싱 일관성 확보, WAF 규칙 강화        |

---

혹시 실제 로그나 요청 캡처를 보여주면 더 정확하게 어떤 시도가 있었는지 분석해줄 수 있어요.
필요하면 Burp Suite나 curl로 실습하는 예제도 만들어줄게요.
